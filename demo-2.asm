.model small
.stack 100h

; –û–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä, —è–∫—ñ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è –≤ —ñ–Ω—à–æ–º—É —Ñ–∞–π–ª—ñ
extrn set_graphic_mode:proc   ; –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É
extrn set_text_mode:proc      ; –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º—É
extrn draw_char:proc          ; –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è —Å–∏–º–≤–æ–ª—É
extrn draw_rectangle:proc     ; –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞
extrn draw_pixel:proc         ; –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è –ø—ñ–∫—Å–µ–ª—è
extrn draw_string:proc        ; –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è —Ä—è–¥–∫—É
;TODO: extrn font_data:byte

.data
    ; –û–≥–æ–ª–æ—à–µ–Ω–Ω—è –∫–æ–ª—å–æ—Ä—ñ–≤
    black        dw 0
    blue         dw 1
    green        dw 2
    cyan         dw 3
    red          dw 4
    magenta      dw 5
    yellow       dw 6
    gray         dw 7
    dark_gray    dw 8

    color        dw 0                                         ; –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∫–æ–ª—ñ—Ä
    mode         db 0                                         ; –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –≥—Ä–∞—Ñ—ñ—á–Ω–∏–π —Ä–µ–∂–∏–º
    hello_string db 'Hello Wrold. Raymond! ì™‡†ı≠·Ï™† ¨Æ¢†. êi§≠•·•≠Ï™†',0    ; –†—è–¥–æ–∫ –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π –Ω—É–ª–µ–º


.code
    start:          
                    mov  ax, @data
                    mov  ds, ax                     ; –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å–µ–≥–º–µ–Ω—Ç –¥–∞–Ω–∏—Ö

    cycle_modes:    
    ; –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É
                    mov  al, [mode]
                    call set_graphic_mode

    ; –ú–∞–ª—é–≤–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫—ñ–≤ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ–ª—å–æ—Ä–∞–º–∏
                    mov  cx, 0                      ; –ü–æ—á–∞—Ç–∫–æ–≤–∞ X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞
                    mov  ax, [color]                ; –ö–æ–ª—ñ—Ä –ø—ñ–∫—Å–µ–ª—è (—Å–ø–æ—á–∞—Ç–∫—É —á–æ—Ä–Ω–∏–π)
    cycle_rectangle:
                    add  cx, 10                     ; –ó–º—ñ—â—É—î–º–æ X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –Ω–∞ 10
                    mov  dx, 10                     ; –ü–æ—á–∞—Ç–∫–æ–≤–∞ Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞
                    mov  bx, 10                     ; –®–∏—Ä–∏–Ω–∞ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞
                    mov  si, 10                     ; –í–∏—Å–æ—Ç–∞ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞
                    call draw_rectangle             ; –í–∏–∫–ª–∏–∫–∞—î–º–æ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –º–∞–ª—é–≤–∞–Ω–Ω—è –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞
                    inc  ax                         ; –ó–º—ñ–Ω—é—î–º–æ –∫–æ–ª—ñ—Ä –ø—ñ–∫—Å–µ–ª—è
                    cmp  ax, 16                     ; –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø–µ—Ä–µ–≤–∏—â–∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
                    jl   cycle_rectangle            ; –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—è –¥–æ —Ü–∏–∫–ª—É, —è–∫—â–æ –∫–æ–ª—ñ—Ä –º–µ–Ω—à–∏–π –∑–∞ 16

    ; ; –í–∏–≤–µ–¥–µ–Ω–Ω—è —Å–∏–º–≤–æ–ª—É
    ;                 mov  al, 'H'
    ;                 mov  cx, 10
    ;                 mov  dx, 150
    ;                 mov  bl, 15
    ;                 call draw_char

    ; ; –í–∏–≤–µ–¥–µ–Ω–Ω—è —Å–∏–º–≤–æ–ª—É
    ;                 mov  al, 'E'
    ;                 add  cx, 8
    ;                 call draw_char

    ; ; –í–∏–≤–µ–¥–µ–Ω–Ω—è —Å–∏–º–≤–æ–ª—É
    ;                 mov  al, 'L'
    ;                 add  cx, 8
    ;                 call draw_char

    ; ; –í–∏–≤–µ–¥–µ–Ω–Ω—è —Å–∏–º–≤–æ–ª—É
    ;                 mov  al, 'L'
    ;                 add  cx, 8
    ;                 call draw_char

    ; ; –í–∏–≤–µ–¥–µ–Ω–Ω—è —Å–∏–º–≤–æ–ª—É
    ;                 mov  al, 'O'
    ;                 add  cx, 8
    ;                 call draw_char
    ; ; –í–∏–≤–µ–¥–µ–Ω–Ω—è —Å–∏–º–≤–æ–ª—É
    ;                 mov  al, '@'
    ;                 add  cx, 8
    ;                 call draw_char


                    mov  si, offset hello_string
                    mov  cx, 80                     ; –ü–æ—á–∞—Ç–∫–æ–≤–∞ X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞
                    mov  dx, 150                    ; Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞
                    mov  bl, 15                     ; –ö–æ–ª—ñ—Ä (–±—ñ–ª–∏–π –≤ 16-–∫–æ–ª—å–æ—Ä–æ–≤—ñ–π –ø–∞–ª—ñ—Ç—Ä—ñ)
                    call draw_string
    


    ; –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–ª–∞–≤—ñ—à—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
                    mov  ah, 0
                    int  16h

    ; –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≥—Ä–∞—Ñ—ñ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É
                    inc  [mode]
                    cmp  [mode], 3                  ; –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –º–µ–∂—É (3)
                    jl   cycle_modes                ; –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—è –¥–æ –ø–æ—á–∞—Ç–∫—É —Ü–∏–∫–ª—É, —è–∫—â–æ —Ä–µ–∂–∏–º –º–µ–Ω—à–∏–π –∑–∞ 3

    ; –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º—É
                    call set_text_mode

    ; –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏
                    mov  ax, 4C00h
                    int  21h
end start